# 3.6 数据流转全景图 (Data Lifecycle Panorama)

本节描述数字资源在系统全生命周期中的流转过程，明确 SIP（提交包）、AIP（保存包）与 DIP（分发包）的转化逻辑与关键处理节点。

## 1. 核心数据流向图

```mermaid
flowchart TD
    %% 定义样式
    classDef storage fill:#e1f5fe,stroke:#01579b,stroke-width:2px;
    classDef process fill:#fff9c4,stroke:#fbc02d,stroke-width:2px;
    classDef actor fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px;

    User((生产者/采集员)):::actor
    SysAdmin((系统管理员)):::actor
    Public((公众/研究员)):::actor

    subgraph Ingest [资源采集与接收 (Ingest)]
        direction TB
        A1[上传/挂载 SIP]:::process
        A2[病毒扫描 & 格式校验]:::process
        A3[元数据提取 & 编目]:::process
        A4[质量检查 (QC)]:::process
    end

    subgraph Storage [长期保存与存储 (Archival Storage)]
        direction TB
        B1[生成 AIP (主文件+元数据+校验)]:::process
        B2[写入冷存储 (磁带/蓝光)]:::storage
        B3[生成低码率/缩略图 (衍生文件)]:::process
        B4[写入热存储 (SSD/对象存储)]:::storage
    end

    subgraph Access [资源利用与发布 (Access)]
        direction TB
        C1[检索与浏览]:::process
        C2[申请下载/授权]:::process
        C3[生成 DIP (发布包)]:::process
        C4[水印/脱敏处理]:::process
    end

    User --> A1
    A1 --> A2 --> A3 --> A4
    A4 -- 通过 --> B1
    A4 -- 不通过 --> A1
    
    B1 --> B2
    B1 --> B3
    B3 --> B4
    
    B4 -.-> C1
    C1 --> C2
    C2 --> C4 --> C3
    C3 --> Public
    
    SysAdmin -.-> B1
```

## 2. 关键数据对象定义

| 数据包类型 | 组成内容 | 存储位置 | 访问频次 | 典型用途 |
| :--- | :--- | :--- | :--- | :--- |
| **SIP (Submission Information Package)** | 原始文件（如 RAW/TIFF）、采集清单、技术参数单 | 临时存储区 / 采集工作站 | 仅采集期 | 数据交接、初审、完整性校验 |
| **AIP (Archival Information Package)** | 归档主文件（无损）、保存元数据（METS/PREMIS）、Fixity 校验值 | 冷存储（磁带库/光盘库/归档云） | 极低（仅灾备恢复或重制时调用） | 长期保存、作为数字资产的“底本” |
| **DIP (Dissemination Information Package)** | 衍生文件（JPG/H.264/GLB）、展示元数据、水印/Logo | 热存储（高性能磁盘/CDN） | 高频 | 在线浏览、IIIF 服务、公众下载、授权分发 |

## 3. 关键流转节点说明

### 3.1 入库与规范化 (Ingest)
- **SIP 接收**：支持离线硬盘挂载与在线批量上传。
- **一致性校验**：系统自动校验文件数量、大小、格式是否符合 SIP 清单。
- **元数据绑定**：将采集时的技术元数据（拍摄设备、分辨率等）与描述元数据（题名、作者等）绑定。

### 3.2 归档与分层 (Archival)
- **AIP 固化**：入库审核通过后，锁定主文件，计算 SHA-256 校验值，生成 METS 封装包。
- **自动分层**：
    - **主文件** 自动写入冷存储策略（如 AWS Glacier 或 本地磁带库）。
    - **衍生文件** 由转码引擎自动生成（如 TIFF 转 Pyramid Tiled TIFF，ProRes 转 H.264），写入热存储。

### 3.3 发布与交付 (Access)
- **DIP 生成**：根据用户权限与申请场景，实时或异步生成 DIP。
    - **在线浏览**：直接读取热存储中的切片/流媒体数据。
    - **下载交付**：按需打包（BagIt 格式），可包含水印、版权声明文件。
