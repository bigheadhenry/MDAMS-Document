# 3.9 集成架构与接口模式 (Integration Patterns)

明确本系统与外部关键系统的对接方式、数据交换协议与接口规范，确保系统间的互联互通与数据一致性。

## 1. 外部系统集成清单

| 对接系统名称 | 集成方向 | 数据流向 | 集成模式 (Pattern) | 关键接口/协议 | 频次/时效 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **文物管理系统**<br>(Relic Management System) | **入库同步**<br>(Ingest Sync) | RMS -> MDAMS | **ETL 增量同步**<br>+ 消息队列通知 | - REST API (Pull)<br>- Webhook (Push) | 每日/实时 |
| **数字文物库**<br>(Digital Collection) | **对外发布**<br>(Public Access) | MDAMS -> DC | **IIIF Image API**<br>+ IIIF Presentation API | - Manifest URL<br>- Image Service | 实时调用 |
| **数字多宝阁**<br>(3D Showcase) | **三维展示**<br>(3D Viewer) | MDAMS -> DDB | **GLB/USDZ 交付**<br>+ 嵌入式 Viewer | - Model URL<br>- IFrame Embed | 实时调用 |
| **古籍阅览平台**<br>(Rare Book Reader) | **古籍浏览**<br>(Book Reader) | MDAMS -> RB | **IIIF Image API**<br>+ IIIF Presentation API | - Manifest URL (Book)<br>- Page Image | 实时调用 |
| **OA 办公系统**<br>(Office Automation) | **审批流转**<br>(Approval) | MDAMS <-> OA | **SSO 单点登录**<br>+ 待办消息推送 | - OAuth2 / CAS<br>- Message Push | 实时交互 |

## 2. 核心接口规范

### 2.1 文物数据同步接口 (Sync API)
- **协议**：RESTful API (JSON)
- **鉴权**：API Key + IP 白名单
- **场景**：
    - `GET /api/relics/sync?since={timestamp}`：获取自上次同步后的变更文物列表。
    - `GET /api/relics/{id}/metadata`：获取指定文物的详细元数据（用于绑定 SIP）。

### 2.2 IIIF 图像服务接口 (Image API)
- **协议**：IIIF Image API 3.0
- **鉴权**：Token 验证 / Referer 防盗链
- **场景**：
    - `GET /{identifier}/{region}/{size}/{rotation}/{quality}.{format}`
    - **示例**：`/image/12345/full/pct:50/0/default.jpg` (获取 50% 缩放图)
    - **用途**：支撑前端 Deep Zoom (深度缩放) 查看器 (如 Mirador / OpenSeadragon)。

### 2.3 IIIF 呈现一致性接口 (Presentation API)
- **协议**：IIIF Presentation API 3.0
- **格式**：JSON-LD
- **场景**：
    - `GET /{identifier}/manifest.json`
    - **内容**：描述图像序列、画布 (Canvas)、元数据标签、结构关系。
    - **用途**：支撑古籍翻页、画卷平铺展示，作为与外部展示平台的通用交换格式。

### 2.4 资源检索接口 (Search API)
- **协议**：RESTful API (JSON)
- **引擎**：Elasticsearch DSL
- **场景**：
    - `POST /api/search`
    - **参数**：`keywords`, `filters` (年代/分类/材质), `page`, `sort`
    - **响应**：资源列表 (含缩略图 URL、IIIF Manifest URL、基础元数据)。

## 3. 数据交换与ETL策略

- **全量初始化**：项目上线前，通过中间库 (Staging DB) 进行一次性全量数据迁移。
- **增量更新**：
    - **变更捕获 (CDC)**：监听文物管理系统数据库日志或消息队列。
    - **定时任务**：每晚 [02:00] 执行 ETL 脚本，同步当日新增/修改的文物信息。
- **一致性校验**：每周执行一次数据对账 (Reconciliation)，确保两端文物状态一致。
