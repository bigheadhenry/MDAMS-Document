# 3.10 安全与权限架构 (Security Architecture)

本节明确系统的安全保障机制，涵盖网络边界、应用访问、数据完整性与合规审计，确保数字资产的安全可控。

## 1. 总体安全架构图

```mermaid
graph TD
    %% 样式定义
    classDef layer fill:#e1f5fe,stroke:#01579b,stroke-width:2px;
    classDef module fill:#fff9c4,stroke:#fbc02d,stroke-width:1px;
    classDef sec fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px;

    User(用户/外部系统) --> WAF[WAF / API 网关]:::sec
    WAF --> Auth[认证服务 (IAM)]:::sec
    
    subgraph AppLayer [应用服务层]
        direction TB
        Auth --> Service[业务服务 (Ingest/Access/Admin)]:::module
        Service --> Audit[审计日志服务]:::sec
    end
    
    subgraph DataLayer [数据存储层]
        direction TB
        Service --> DB[(元数据 DB)]:::layer
        Service --> Storage[(对象存储 / 磁带库)]:::layer
        Storage -.-> Encrypt[静态加密 (KMS)]:::sec
        Storage -.-> Fixity[完整性校验 (Checksum)]:::sec
    end
    
    class AppLayer layer
    class DataLayer layer
```

## 2. 关键安全控制点

### 2.1 网络边界安全 (Network Security)
- **API 网关 (Gateway)**：统一入口，实施流量控制 (Rate Limiting)、IP 黑白名单与 SSL/TLS 卸载。
- **WAF 防护**：防御 SQL 注入、XSS 跨站脚本、恶意爬虫 (Anti-Bot)。
- **防盗链 (Hotlink Protection)**：针对 IIIF 图像服务，检查 `Referer` 头，仅允许授权域名调用。

### 2.2 身份与访问控制 (IAM)
- **统一认证 (SSO)**：对接现有 OA/LDAP 系统，支持 CAS / OAuth2 协议。
- **RBAC (基于角色的访问控制)**：
    - **系统管理员**：全权管理，含用户、策略、日志。
    - **采集员**：仅限上传 SIP、查看本人任务。
    - **审核员**：仅限查看待审任务、执行通过/驳回。
    - **普通用户**：仅限检索、浏览公开资源。
- **ABAC (基于属性的访问控制)**：
    - **细粒度权限**：如“未发布资源仅限馆内 IP 访问”、“高清大图仅限研究员下载”。

### 2.3 数据安全与完整性 (Data Security)
- **传输加密**：全站强制 HTTPS (TLS 1.2+)。
- **静态加密 (At-Rest Encryption)**：敏感元数据 (如估价、来源) 数据库加密存储；AIP 存储支持服务端加密 (SSE)。
- **完整性校验 (Fixity)**：
    - **入库校验**：计算 SIP 文件的 SHA-256 摘要。
    - **存储巡检**：定期 (如每季度) 扫描 Cold 层 AIP，比对摘要值，发现位衰减 (Bit Rot) 自动报警并从副本恢复。
- **数字水印 (Watermarking)**：
    - **显式水印**：DIP 下载/浏览时，动态叠加“XX博物馆”Logo 与用户 ID。
    - **隐式水印** (可选)：在频域嵌入版权信息，用于侵权追踪。

### 2.4 安全审计 (Audit Logging)
- **审计范围**：
    - **用户行为**：登录/登出、关键操作 (增删改)、下载/导出。
    - **系统事件**：配置变更、权限修改、异常报错。
    - **数据访问**：敏感资源 (如一级文物) 的浏览与下载记录。
- **日志留存**：审计日志至少保留 [6] 个月 (符合等保要求)，支持按用户/时间/对象检索。

## 3. 等保合规建议 (Level 3)

- **身份鉴别**：双因子认证 (MFA)、密码复杂度策略、定期更换。
- **访问控制**：最小权限原则 (Least Privilege)、默认拒绝。
- **安全审计**：日志不可篡改、定期备份。
- **数据备份**：异地灾备 (DR)、定期恢复演练。
